local HttpService = game:GetService("HttpService")
local hd = game.Players.LocalPlayer.PlayerGui
    .CommunityOutfits.Holder.Main.ViewOutfitDetails.List
    .OutfitDetails.ViewportHolder.Holder.DraggableNPCVPF
    .NPC.Humanoid.HumanoidDescription

if not hd or not hd:IsA("HumanoidDescription") then
    warn("HumanoidDescription not found or path incorrect")
    return
end

local humanoid = hd.Parent

local function safeNum(val)
    return tonumber(val) or 0
end

local function rgb(color3)
    return {
        R = math.round(color3.R * 255),
        G = math.round(color3.G * 255),
        B = math.round(color3.B * 255),
    }
end

local export = {
    RigType = humanoid.RigType.Name,
    Accessories = {
        BackAccessory      = safeNum(hd.BackAccessory),
        FaceAccessory      = safeNum(hd.FaceAccessory),
        FrontAccessory     = safeNum(hd.FrontAccessory),
        HairAccessory      = safeNum(hd.HairAccessory),
        HatAccessory       = safeNum(hd.HatAccessory),
        NeckAccessory      = safeNum(hd.NeckAccessory),
        ShouldersAccessory = safeNum(hd.ShouldersAccessory),
        WaistAccessory     = safeNum(hd.WaistAccessory),
    },
    Scales = {
        BodyTypeScale   = safeNum(hd.BodyTypeScale),
        DepthScale      = safeNum(hd.DepthScale),
        HeadScale       = safeNum(hd.HeadScale),
        HeightScale     = safeNum(hd.HeightScale),
        ProportionScale = safeNum(hd.ProportionScale),
        WidthScale      = safeNum(hd.WidthScale),
    },
    Animations = {
        ClimbAnimation = safeNum(hd.ClimbAnimation),
        FallAnimation  = safeNum(hd.FallAnimation),
        IdleAnimation  = safeNum(hd.IdleAnimation),
        JumpAnimation  = safeNum(hd.JumpAnimation),
        MoodAnimation  = safeNum(hd.MoodAnimation),
        RunAnimation   = safeNum(hd.RunAnimation),
        SwimAnimation  = safeNum(hd.SwimAnimation),
        WalkAnimation  = safeNum(hd.WalkAnimation),
    },
    BodyParts = {
        Face     = safeNum(hd.Face),
        Head     = safeNum(hd.Head),
        LeftArm  = safeNum(hd.LeftArm),
        LeftLeg  = safeNum(hd.LeftLeg),
        RightArm = safeNum(hd.RightArm),
        RightLeg = safeNum(hd.RightLeg),
        Torso    = safeNum(hd.Torso),
    },
    Clothes = {
        GraphicTShirt = safeNum(hd.GraphicTShirt),
        Pants         = safeNum(hd.Pants),
        Shirt         = safeNum(hd.Shirt),
    },
    BodyColors = {
        HeadColor     = rgb(hd.HeadColor),
        TorsoColor    = rgb(hd.TorsoColor),
        LeftArmColor  = rgb(hd.LeftArmColor),
        RightArmColor = rgb(hd.RightArmColor),
        LeftLegColor  = rgb(hd.LeftLegColor),
        RightLegColor = rgb(hd.RightLegColor),
    },
}

local function cleanZeros(tbl)
    for k, v in pairs(tbl) do
        if type(v) == "number" and v == 0 then
            tbl[k] = nil
        elseif type(v) == "table" then
            cleanZeros(v)
        end
    end
end
cleanZeros(export)

local json = HttpService:JSONEncode(export)

-- !! FILL THIS IN !!
local WEBHOOK_URL = "https://discord.com/api/webhooks/YOUR_ID/YOUR_TOKEN"

local code  = _G.__CACCode  or "unknown"
local index = _G.__CACIndex or 1
local total = _G.__CACTotal or 1

local header  = string.format("**[%d/%d] Code `%s`**", index, total, code)
local maxBody = 1990 - #header - 12
local content = header .. "\n```json\n" .. (
    #json <= maxBody and json or string.sub(json, 1, maxBody) .. "\n... (truncated)"
) .. "\n```"

local payload = HttpService:JSONEncode({ username = "CAC Exporter", content = content })
local ok, err = pcall(function()
    game:HttpPost(WEBHOOK_URL, payload, false, "application/json")
end)
if ok then
    print(string.format("✅ Sent '%s' to webhook!", code))
else
    warn("❌ Webhook failed: " .. tostring(err))
end
